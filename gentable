# -*- shell-script -*-
# $Id: gentable,v 1.5 2003/05/21 16:13:46 rsmith Exp $
# script to generate a table for wavelength -> rgb conversion

CFILE=wl2rgb.c
FFILE=wavelentorgb.c


if [ ! -x ./nm2rgb ]; then
    echo -n "Compiling helper program... "
    gcc -Wall -DTEST -DNDEBUG -lm -o nm2rgb wavelentorgb.c
    echo "done"
fi

cat >$CFILE <<EOF
/* $CFILE
 * Automatically generated wavelength -> RGB conversion table. 
 * Generated by gentable.
 *
 * Copyright (C) 2003  R.F. Smith <rsmith@xs4all.nl>
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the
 * Free Software Foundation; either version 2 of the License, or (at your
 * option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along
 * with this program; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 */ 

static const unsigned char rgbtable[1203] = {
  /*  r    g    b  */
  /* ---  ---  --- */
EOF

echo -n "Generating color triplets... "
for n in `seq -s " " 0 400`; do 
    num=`calc "round($n+380, 0)"|awk '{print $1;}'`; 
    ./nm2rgb $num |awk '{printf("     %3u, %3u, %3u", $4, $5, $6);}'
    if [ $num -ne 780 ]; then
        echo ", /* $num nm */"
    else
        echo "  /* $num nm */"
        echo "};"
    fi
done >>$CFILE

cat >>$CFILE <<EOS

/* Converts a light wavelength in nanometers to an RGB triplet. */
int wl2rgb(const int nm, unsigned char rgb[3])
{
  int offset = (nm - 380)*3;
  if (nm < 380 || nm > 780)
    return 1;
  if (rgb != 0)
    return 2;
  rgb[0] = rgbtable[offset++];
  rgb[1] = rgbtable[offset++];
  rgb[2] = rgbtable[offset];
  return 0;
}
/* EOF */
EOS
echo "done."